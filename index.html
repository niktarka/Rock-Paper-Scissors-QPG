
<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no"/>
<title>QuickPlay Games ‚Äî ROCK ¬∑ PAPER ¬∑ SCISSORS</title>
<style>
  /* ============================================================
     QUICKPLAY GAMES ‚Äî –ù–µ–æ–Ω-–¥–∞—Ä–∫ —Å—Ç–∏–ª—å –∑ —Ç–µ–º–∞–º–∏ –π i18n
     –ï–∫—Ä–∞–Ω–∏: Loading(3s), Menu, Game, Online, Result
     ============================================================ */
  :root{
    --bg:#0b1220; --bg2:#090f1c;
    --panel:#141b2a; --panel2:#0f1624;
    --fg:#e8eef7; --fg-d:#aeb9cc;
    --a:#4cc4ff; --a2:#8a63ff; --ok:#29f0b0; --danger:#ff4c6d; --warn:#f7c948;
    --border:rgba(255,255,255,0.08);
    --shadow:0 40px 80px rgba(0,0,0,0.45);
  }
  /* –¢–µ–º–∏ */
  .theme-light{
    --bg:#f5f7fb; --bg2:#eef1f8;
    --panel:#ffffff; --panel2:#edf2fb;
    --fg:#1c2431; --fg-d:#5a6b84;
    --a:#2b7fff; --a2:#5f3cff; --ok:#00b87a; --danger:#ff3b57; --warn:#f7c948;
    --border:rgba(28,36,49,0.12);
    --shadow:0 30px 60px rgba(0,0,0,0.25);
  }
  .theme-neon{
    --bg:#05070f; --bg2:#060711;
    --panel:#0a0f1a; --panel2:#070a14;
    --fg:#eaf4ff; --fg-d:#8ea7cc;
    --a:#00e5ff; --a2:#7a00ff; --ok:#00ffa3; --danger:#ff2b6e; --warn:#ffd166;
    --border:rgba(255,255,255,0.1);
  }

  *{box-sizing:border-box}
  html,body{
    margin:0;padding:0;width:100%;height:100%;
    background: radial-gradient(1200px at 50% 30%, var(--bg2), var(--bg) 70%);
    color:var(--fg);
    font-family: Inter,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Noto Sans",Arial;
    overflow:hidden; overscroll-behavior:none;
  }
  /* –ö—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è –º–æ–±—ñ–ª—å–Ω–∏—Ö: 100svh, —â–æ–±–∏ –≤—Ä–∞—Ö–æ–≤—É–≤–∞—Ç–∏ —Å–∏—Å—Ç–µ–º–Ω—ñ –ø–∞–Ω–µ–ª—ñ */
  .screen{position:absolute;inset:0;display:none;align-items:center;justify-content:center;padding:2vh 2vw; min-height:100svh;}
  .panel{
    width:min(1100px,94vw); min-height:min(680px,88vh);
    background:
      linear-gradient(180deg, rgba(76,196,255,0.08), transparent 40%),
      linear-gradient(180deg, rgba(138,99,255,0.08), transparent 70%),
      linear-gradient(180deg, var(--panel), var(--panel2));
    border:1px solid var(--border); border-radius:22px; box-shadow:var(--shadow);
    backdrop-filter:blur(8px);
    padding: clamp(16px,2.6vw,28px);
    display:flex; flex-direction:column;
  }

  /* ---------- LOADING ---------- */
  #loading{display:flex}
  .loading-wrap{text-align:center; user-select:none; width:100%;}
  .logo{display:flex;align-items:center;gap:12px;justify-content:center;margin-bottom:6px;}
  .mark{width:42px;height:42px;border-radius:12px;transform:rotate(10deg);
        background:conic-gradient(from 210deg,var(--a)0 120deg,var(--a2)120deg 240deg,var(--ok)240deg 360deg);
        box-shadow:0 10px 24px rgba(76,196,255,0.25);}
  .title{
    font-size: clamp(36px, 8vw, 88px); font-weight: 900; letter-spacing: 1.2px;
    text-shadow: 0 24px 60px rgba(76,196,255,0.28), 0 0 120px rgba(76,196,255,0.35);
  }
  .dots{margin-top:10px; color:var(--fg-d); font-size:18px; letter-spacing:.8px;}
  .spinner{
    width:74px;height:74px;margin:26px auto 0;border-radius:50%;
    background:conic-gradient(from 0deg, var(--a) 0 60deg, transparent 60deg 360deg);
    animation:spin 1.2s linear infinite; box-shadow:0 0 42px rgba(76,196,255,0.35);
  }
  @keyframes spin{to{transform:rotate(360deg)}}
  .fade-out{animation:fadeOut .8s ease forwards}
  @keyframes fadeOut{to{opacity:0; transform:scale(.98)}}

  /* ---------- MENU ---------- */
  .menu-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:10px;}
  .brand{display:flex;align-items:center;gap:12px;font-weight:900;font-size:22px;}
  .row{display:flex;align-items:center;gap:10px;flex-wrap:wrap}
  .btn{
    appearance:none; border:1px solid var(--border); outline:none; cursor:pointer;
    border-radius:16px; padding:12px 16px; font-size:16px; font-weight:800; color:var(--fg);
    background: linear-gradient(180deg,#1a2330aa,#101720aa);
    box-shadow: 0 12px 24px rgba(0,0,0,0.35), inset 0 1px 0 rgba(255,255,255,0.08);
    transition: transform .08s ease, filter .2s ease, box-shadow .2s ease;
    text-align:left;
  }
  .btn:hover{filter:brightness(1.08)}
  .btn:active{transform:translateY(1px)}
  .btn.primary{
    border-color:#4cc4ff66;
    background: linear-gradient(180deg, rgba(76,196,255,0.25), rgba(76,196,255,0.12)), linear-gradient(180deg,#1c2731,#121923);
    box-shadow: 0 14px 28px rgba(76,196,255,0.22);
  }
  .btn.warn{border-color:#f7c94866; box-shadow:0 14px 28px rgba(247,201,72,0.18);}
  .btn.danger{border-color:#ff4c6d66; box-shadow:0 14px 28px rgba(255,76,109,0.18);}
  .grid{display:grid; grid-template-columns: repeat(2,1fr); gap:12px; margin-top:12px;}
  .small{font-size:13px;color:var(--fg-d)}

  /* ---------- GAME LAYOUT ---------- */
  .game-wrap{
    display:grid; grid-template-rows: auto 1fr auto;
    gap:10px; min-height: calc(88vh - 60px);
    flex:1;
  }
  .hud{display:flex; align-items:center; justify-content:space-between; gap:10px; flex-wrap:wrap;}
  .pill{padding:8px 12px; border-radius:14px; border:1px solid var(--border); background:linear-gradient(180deg,#1b2432,#121923); font-weight:800; box-shadow:0 10px 20px rgba(0,0,0,0.35)}
  .center-res{display:grid; place-items:center; border-radius:16px; border:1px solid var(--border); background:linear-gradient(180deg,#182030,#121720); box-shadow: inset 0 12px 24px rgba(0,0,0,0.4); font-weight:900; padding:16px; min-height:120px;}
  .res-big{font-size: clamp(22px, 6vw, 28px); margin-bottom:6px;}
  .res-sub{font-size:14px; color:var(--fg-d)}
  .glow-win{box-shadow: 0 0 0 0 rgba(41,240,176,0.45); animation:winPulse 900ms ease forwards}
  .glow-lose{box-shadow: 0 0 0 0 rgba(255,76,109,0.45); animation:losePulse 900ms ease forwards}
  @keyframes winPulse{50%{box-shadow:0 0 40px 6px rgba(41,240,176,0.45)} 100%{box-shadow:0 0 0 0 rgba(0,0,0,0)}}
  @keyframes losePulse{50%{box-shadow:0 0 40px 6px rgba(255,76,109,0.45)} 100%{box-shadow:0 0 0 0 rgba(0,0,0,0)}}

  /* ---------- ACTION BAR (–∞–¥–∞–ø—Ç–∏–≤–Ω–∞) ---------- */
  .action-bar{
    display:grid; grid-template-columns: repeat(3, 1fr); gap:12px; align-items:center;
    padding-bottom: env(safe-area-inset-bottom);
  }
  .action-btn{
    min-height:64px; padding:14px 16px;
    border-radius:16px; border:1px solid var(--border); cursor:pointer; user-select:none;
    background: linear-gradient(180deg, #1a2330, #121923);
    box-shadow: 0 10px 24px rgba(0,0,0,0.35);
    font-size: clamp(18px, 4vw, 22px); font-weight:900;
    display:flex; justify-content:center; align-items:center; gap:10px;
  }
  .action-btn span{font-size: clamp(22px, 6vw, 28px)}
  .action-btn.rock{outline:2px solid rgba(76,196,255,0.22)}
  .action-btn.scissors{outline:2px solid rgba(138,99,255,0.25)}
  .action-btn.paper{outline:2px solid rgba(41,240,176,0.25)}
  .action-btn:hover{filter:brightness(1.08)}
  .action-btn:active{transform:translateY(1px)}

  /* ‚Äî‚Äî‚Äî –ú–æ–±—ñ–ª—å–Ω–∏–π —Ñ—ñ–∫—Å: —è–∫—â–æ –º–∞–ª–æ –º—ñ—Å—Ü—è ‚Äî ¬´–ü–∞–ø—ñ—Ä¬ª –Ω–∞ 2-–π —Ä—è–¥ –ø–æ–≤–Ω—ñ—Å—Ç—é ‚Äî‚Äî‚Äî */
  @media (max-width:420px), (max-height:560px){
    .action-bar{ grid-template-columns: repeat(2,1fr); }
    .action-btn{ min-height:56px; padding:12px; }
    .center-res{ min-height:96px; }
    .action-btn.paper{ grid-column: 1 / -1; } /* –ü–ê–ü–Ü–† ‚Äî —à–∏—Ä–∏–Ω–æ—é –Ω–∞ –≤—Å—é –ª—ñ–Ω—ñ—é */
  }
  @media (max-height:480px){
    .center-res{min-height:84px}
    .action-btn{min-height:52px}
  }

  /* ---------- OVERLAYS ---------- */
  .overlay{position:absolute; inset:0; display:none; align-items:center; justify-content:center; background:#0007; backdrop-filter:blur(6px)}
  .box{width:min(620px,92vw); padding:16px; background: linear-gradient(180deg,var(--panel),var(--panel2)); border:1px solid var(--border); border-radius:18px; box-shadow:0 30px 60px rgba(0,0,0,0.5);}
  .box h2{margin:0 0 8px}
  .box .grid{grid-template-columns:1fr}

  /* ---------- ONLINE ROOM UI ---------- */
  input[type="text"], input[type="number"], textarea{
    background: #0f1624; color: var(--fg); border:1px solid var(--border); border-radius:12px;
    padding:10px 12px; outline:none; font-size:16px; width:100%;
  }
</style>
</head>
<body>

<!-- ============ LOADING (3s) ============ -->
<section id="loading" class="screen">
  <div class="panel loading-wrap">
    <div class="logo"><div class="mark"></div><div style="font-weight:900;" data-i18n="brand">QuickPlay Games</div></div>
    <div class="title" data-i18n="title">ROCK ¬∑ PAPER ¬∑ SCISSORS</div>
    <div class="dots" id="dots" data-i18n="loading">Loading...</div>
    <div class="spinner"></div>
    <div class="small" style="margin-top:8px;" data-i18n="studioNote">–ú—ñ–Ω—ñ–º–∞–ª—ñ–∑–º, –Ω–µ–æ–Ω, —à–≤–∏–¥–∫—ñ –º–∞—Ç—á—ñ.</div>
  </div>
</section>

<!-- ============ MENU ============ -->
<section id="menu" class="screen">
  <div class="panel" style="position:relative;">
    <div class="menu-header">
      <div class="brand"><div class="mark"></div><div data-i18n="brand">QuickPlay Games</div></div>
      <div class="row small">
        <span data-i18n="sound">–ó–≤—É–∫</span>: <span id="soundState">ON</span>
        <button class="btn" id="btnLang">üåê <span id="langVal">–£–∫—Ä–∞—ó–Ω—Å—å–∫–∞</span></button>
        <button class="btn" id="btnTheme">üé® <span data-i18n="theme">–¢–µ–º–∞</span>: <span id="themeVal">Dark</span></button>
      </div>
    </div>

    <h2 style="margin:0 0 6px;" data-i18n="title">ROCK ¬∑ PAPER ¬∑ SCISSORS</h2>
    <div class="small" data-i18n="menuDesc">–ö–ª–∞—Å–∏–∫–∞ –∑ —Å—É—á–∞—Å–Ω–∏–º –Ω–µ–æ–Ω-—Å—Ç–∏–ª–µ–º. –û–±–µ—Ä–∏ —Ä–µ–∂–∏–º: –ø—Ä–æ—Ç–∏ –®–Ü –∞–±–æ –æ–Ω–ª–∞–π–Ω‚Äë–∫—ñ–º–Ω–∞—Ç–∏.</div>

    <div class="grid">
      <button class="btn primary" id="btnPlay" data-i18n="play">–ì—Ä–∞—Ç–∏</button>
      <button class="btn" id="btnAI"><span data-i18n="vsAI">–ü—Ä–æ—Ç–∏ –®–Ü</span> ¬∑ <span data-i18n="difficulty">–°–∫–ª–∞–¥–Ω—ñ—Å—Ç—å</span>: <span id="aiDiff">Normal</span></button>
      <button class="btn" id="btnOnline" data-i18n="onlineRooms">–û–Ω–ª–∞–π–Ω: –∫—ñ–º–Ω–∞—Ç–∏</button>
      <button class="btn" id="btnSound"><span data-i18n="sound">–ó–≤—É–∫</span>: <span id="soundLabel">–£–≤—ñ–º–∫</span></button>
      <button class="btn" id="btnThrowFx">üé≤ <span data-i18n="throwFx">–†–µ–∂–∏–º –∫–∏–¥–∫–∞ (3‚Äë2‚Äë1)</span>: <span id="throwFxVal">ON</span></button>
      <button class="btn" id="btnHaptics">üì≥ <span data-i18n="haptics">–í—ñ–±—Ä–∞—Ü—ñ—è</span>: <span id="hapticsVal">ON</span></button>
      <button class="btn danger" id="btnReset" data-i18n="reset">–ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ (—Å–∫–∏–Ω—É—Ç–∏ —Ä–µ–∫–æ—Ä–¥–∏)</button>
      <div class="btn">
        <div class="small" data-i18n="controlsHint">–ü–ö: 1 ‚Äî ü™®, 2 ‚Äî ‚úÇÔ∏è, 3 ‚Äî üìÑ ¬∑ –ú–æ–±—ñ–ª—å–Ω—ñ: –≤–µ–ª–∏–∫—ñ –∫–Ω–æ–ø–∫–∏. –†–∞—Ö—É–Ω–æ–∫ —ñ —Å–µ—Ä—ñ—è –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è; –æ–Ω–ª–∞–π–Ω ‚Äî –ª–æ–±—ñ —Ç–∞ —Ç–∞–π–º–µ—Ä.</div>
      </div>
    </div>

    <!-- –í–∏–±—ñ—Ä —Ä–µ–∂–∏–º—É -->
    <div id="modeOverlay" class="overlay">
      <div class="box">
        <h2 data-i18n="chooseMode">–í–∏–±—ñ—Ä —Ä–µ–∂–∏–º—É</h2>
        <div class="grid">
          <button class="btn primary" id="mAI" data-i18n="vsAI">–ü—Ä–æ—Ç–∏ –®–Ü</button>
          <button class="btn" id="mOnline" data-i18n="onlineRooms">–û–Ω–ª–∞–π–Ω: –∫—ñ–º–Ω–∞—Ç–∏</button>
          <button class="btn danger" id="mCancel" data-i18n="cancel">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
        </div>
      </div>
    </div>

    <!-- –û–Ω–ª–∞–π–Ω –º–µ–Ω—é -->
    <div id="onlineOverlay" class="overlay">
      <div class="box">
        <h2 data-i18n="onlineRooms">–û–Ω–ª–∞–π–Ω: –∫—ñ–º–Ω–∞—Ç–∏</h2>
        <div class="grid">
          <button class="btn primary" id="oLocal" data-i18n="localRooms">–õ–æ–∫–∞–ª—å–Ω—ñ –∫—ñ–º–Ω–∞—Ç–∏ (–∞–≤—Ç–æ ‚Äú–∑–∞ –∫–æ–¥–æ–º‚Äù)</button>
          <button class="btn" id="oP2P" data-i18n="p2pBeta">P2P Beta (–±–µ–∑ —Å–µ—Ä–≤–µ—Ä–∞; –∫–æ–ø—ñ‚Äë–ø–µ–π—Å—Ç –∫–æ–¥—ñ–≤)</button>
          <button class="btn danger" id="oClose" data-i18n="close">–ó–∞–∫—Ä–∏—Ç–∏</button>
        </div>
      </div>
    </div>

    <!-- –õ–æ–∫–∞–ª—å–Ω–∞ –∫—ñ–º–Ω–∞—Ç–∞ -->
    <div id="localRoomOverlay" class="overlay">
      <div class="box">
        <h2 data-i18n="localRoomTitle">–õ–æ–∫–∞–ª—å–Ω–∞ –∫—ñ–º–Ω–∞—Ç–∞ (—Ü–µ–π –±—Ä–∞—É–∑–µ—Ä)</h2>
        <div class="row">
          <input type="text" id="localName" placeholder="–í–∞—à –Ω—ñ–∫" />
        </div>
        <div class="grid" style="margin-top:8px;">
          <div class="btn">
            <div class="small" data-i18n="localCreateDesc">–°—Ç–≤–æ—Ä–∏—Ç–∏: –Ω–∞–∑–≤–∞ + –∫–æ–¥ (5‚Äì8 —Å–∏–º–≤–æ–ª—ñ–≤) –∞–±–æ –ø–æ—Ä–æ–∂–Ω—å–æ ‚Äî –∑–≥–µ–Ω–µ—Ä—É—î–º–æ.</div>
            <div class="row">
              <input type="text" id="localRoomName" placeholder="–ù–∞–∑–≤–∞ –∫—ñ–º–Ω–∞—Ç–∏" />
              <input type="text" id="localRoomCode" placeholder="–ö–æ–¥ (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, QP123)" maxlength="8" />
              <button class="btn primary" id="localCreate" data-i18n="create">–°—Ç–≤–æ—Ä–∏—Ç–∏</button>
            </div>
          </div>
          <div class="btn">
            <div class="small" data-i18n="localJoinDesc">–ó–Ω–∞–π—Ç–∏: –≤–≤–µ–¥—ñ—Ç—å –∫–æ–¥ –∫—ñ–º–Ω–∞—Ç–∏ ‚Äî –ø—Ä–∏—î–¥–Ω–∞—î–º–æ—Å—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ.</div>
            <div class="row">
              <input type="text" id="localJoinCode" placeholder="–ö–æ–¥ –∫—ñ–º–Ω–∞—Ç–∏" maxlength="8" />
              <button class="btn" id="localJoin" data-i18n="join">–ü—Ä–∏—î–¥–Ω–∞—Ç–∏—Å—è</button>
            </div>
          </div>
          <button class="btn danger" id="localClose" data-i18n="back">–ù–∞–∑–∞–¥</button>
        </div>
      </div>
    </div>

    <!-- P2P Beta -->
    <div id="p2pOverlay" class="overlay">
      <div class="box">
        <h2>P2P Beta</h2>
        <div class="small" data-i18n="p2pDesc">1) –°—Ç–≤–æ—Ä–∏—Ç–∏ ‚Üí –°–∫–æ–ø—ñ—é–π ¬´Offer¬ª —ñ –ø–µ—Ä–µ–¥–∞–π —Å—É–ø–µ—Ä–Ω–∏–∫—É. 2) –í—Å—Ç–∞–≤ ¬´Answer¬ª –≤—ñ–¥ —Å—É–ø–µ—Ä–Ω–∏–∫–∞. –ê–±–æ: –ü—Ä–∏—î–¥–Ω–∞—Ç–∏—Å—è ‚Üí –í—Å—Ç–∞–≤ ¬´Offer¬ª ‚Üí –ó–≥–µ–Ω–µ—Ä—É–π ¬´Answer¬ª —ñ –ø–µ—Ä–µ–¥–∞–π —Ç–≤–æ—Ä—Ü—é.</div>
        <div class="grid" style="margin-top:8px;">
          <div class="btn">
            <div class="small" data-i18n="yourNick">–í–∞—à –Ω—ñ–∫</div>
            <input id="p2pName" type="text" placeholder="–í–∞—à –Ω—ñ–∫"/>
          </div>
          <div class="btn">
            <div class="row">
              <button class="btn primary" id="p2pCreate" data-i18n="createOffer">–°—Ç–≤–æ—Ä–∏—Ç–∏ (Offer)</button>
              <button class="btn" id="p2pJoin" data-i18n="joinOffer">–ü—Ä–∏—î–¥–Ω–∞—Ç–∏—Å—è (–º–∞—é Offer)</button>
            </div>
            <div class="small" style="margin-top:6px;">SDP:</div>
            <textarea id="p2pBox" style="width:100%;height:140px;"></textarea>
            <div class="row" style="margin-top:6px;">
              <button class="btn" id="p2pAccept" data-i18n="insertAnswer">–í—Å—Ç–∞–≤–∏—Ç–∏ –≤—ñ–¥–ø–æ–≤—ñ–¥—å</button>
              <button class="btn danger" id="p2pClose" data-i18n="close">–ó–∞–∫—Ä–∏—Ç–∏</button>
            </div>
          </div>
        </div>
      </div>
    </div>

  </div>
</section>

<!-- ============ GAME ============ -->
<section id="game" class="screen">
  <div class="panel" style="position:relative;">
    <div class="menu-header">
      <div class="brand"><div class="mark"></div><div>QuickPlay ¬∑ RPS</div></div>
      <div class="small" id="hint" data-i18n="hintPC">–ü–ö: 1 ¬∑ 2 ¬∑ 3 ¬∑ ESC ‚Äî –ø–∞—É–∑–∞</div>
    </div>

    <div class="game-wrap">
      <!-- HUD -->
      <div class="hud">
        <div class="pill"><span data-i18n="mode">–†–µ–∂–∏–º</span>: <span id="modeLabel">AI</span></div>
        <div class="pill"><span data-i18n="score">–û—á–∫–∏</span>: <span id="score">0</span></div>
        <div class="pill"><span data-i18n="streak">–°–µ—Ä—ñ—è</span>: <span id="streak">0</span></div>
        <div class="pill"><span data-i18n="best">–†–µ–∫–æ—Ä–¥</span>: <span id="best">0</span></div>
        <div class="pill" id="timerWrap" style="display:none;"><span data-i18n="timer">–¢–∞–π–º–µ—Ä</span>: <span class="timer" id="timerVal">10.0</span>s</div>
        <button class="btn" id="btnPause" data-i18n="pause">–ü–∞—É–∑–∞</button>
      </div>

      <!-- Center Result -->
      <div class="center-res" id="centerBox">
        <div class="res-big" id="resultText" data-i18n="makeChoice">–ó—Ä–æ–±–∏ –≤–∏–±—ñ—Ä</div>
        <div class="res-sub" id="roundInfo">ü™® / ‚úÇÔ∏è / üìÑ</div>
      </div>

      <!-- Action Bar -->
      <div class="action-bar">
        <div class="action-btn rock" id="btnRock"><span>ü™®</span> <span data-i18n="rock">–ö–∞–º—ñ–Ω—å</span> <small style="opacity:.65;">(1)</small></div>
        <div class="action-btn scissors" id="btnScissors"><span>‚úÇÔ∏è</span> <span data-i18n="scissors">–ù–æ–∂–∏—Ü—ñ</span> <small style="opacity:.65;">(2)</small></div>
        <div class="action-btn paper" id="btnPaper"><span>üìÑ</span> <span data-i18n="paper">–ü–∞–ø—ñ—Ä</span> <small style="opacity:.65;">(3)</small></div>
      </div>
    </div>

    <!-- Pause -->
    <div id="pauseOverlay" class="overlay">
      <div class="box">
        <h2 data-i18n="pause">–ü–∞—É–∑–∞</h2>
        <div class="grid">
          <button class="btn primary" id="btnContinue" data-i18n="continue">‚ñ∂ –ü—Ä–æ–¥–æ–≤–∂–∏—Ç–∏</button>
          <button class="btn" id="btnRestartRun" data-i18n="restartMatch">üîÅ –†–µ—Å—Ç–∞—Ä—Ç –º–∞—Ç—á—É</button>
          <button class="btn danger" id="btnBackMenu" data-i18n="backMenu">‚ùå –í –º–µ–Ω—é</button>
        </div>
      </div>
    </div>

    <!-- Result -->
    <div id="resultOverlay" class="overlay">
      <div class="box">
        <h2 id="resTitle" data-i18n="matchEnded">–ú–∞—Ç—á –∑–∞–≤–µ—Ä—à–µ–Ω–æ</h2>
        <div class="small">
          <span data-i18n="score">–û—á–∫–∏</span>: <b id="resScore">0</b> ¬∑
          <span data-i18n="streak">–°–µ—Ä—ñ—è</span>: <b id="resStreak">0</b> ¬∑
          <span data-i18n="best">–†–µ–∫–æ—Ä–¥</span>: <b id="resBest">0</b>
        </div>
        <div class="grid" style="margin-top:10px;">
          <button class="btn primary" id="btnAgain" data-i18n="playAgain">‚ñ∂ –ó—ñ–≥—Ä–∞—Ç–∏ —â–µ</button>
          <button class="btn danger" id="btnToMenu" data-i18n="backMenu">‚ùå –í –º–µ–Ω—é</button>
        </div>
      </div>
    </div>

    <!-- ONLINE LOBBY -->
    <div id="lobbyOverlay" class="overlay">
      <div class="box">
        <h2 id="lobbyTitle" data-i18n="room">–ö—ñ–º–Ω–∞—Ç–∞</h2>
        <div class="small" id="lobbyInfo"><span data-i18n="players">–ì—Ä–∞–≤—Ü—ñ–≤</span>: <span id="lobbyCount">1</span> / 5 ¬∑ <span data-i18n="code">–ö–æ–¥</span>: <b id="lobbyCode"></b></div>
        <div class="row" style="margin-top:8px;">
          <div class="btn" style="flex:1;">
            <div class="small" data-i18n="choiceTimer">–¢–∞–π–º–µ—Ä –≤–∏–±–æ—Ä—É (—Å–µ–∫):</div>
            <input id="lobbyTimer" type="number" min="1" max="30" value="10"/>
          </div>
          <div class="btn" style="flex:1;">
            <div class="small" data-i18n="maxPlayers">–ú–∞–∫—Å. —É—á–∞—Å–Ω–∏–∫—ñ–≤ (2..5):</div>
            <input id="lobbyMax" type="number" min="2" max="5" value="5"/>
          </div>
        </div>
        <div class="grid">
          <button class="btn primary" id="lobbyStart" data-i18n="startRound">‚ñ∂ –ü–æ—á–∞—Ç–∏ —Ä–∞—É–Ω–¥</button>
          <button class="btn" id="lobbyLeave" data-i18n="leaveRoom">–í–∏–π—Ç–∏ –∑ –∫—ñ–º–Ω–∞—Ç–∏</button>
        </div>
        <div class="small" style="margin-top:6px;" data-i18n="timerHint">–ü—ñ–¥–∫–∞–∑–∫–∞: —è–∫—â–æ –Ω–µ –∑—Ä–æ–±–∏—Ç–∏ –≤–∏–±—ñ—Ä –¥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è —Ç–∞–π–º–µ—Ä–∞ ‚Äî –≤–∏ –≤–∏–ª—ñ—Ç–∞—î—Ç–µ –∑ —Ä–∞—É–Ω–¥—É.</div>
      </div>
    </div>

  </div>
</section>

<script>
/* ============================================================
   RPS ‚Äî i18n (RU/UK/EN) + Themes (Dark/Light/Neon) + Throw FX
   AI + Online (Local rooms + P2P Beta)
   ============================================================ */
(function(){
  "use strict";

  /* ---------- i18n ---------- */
  const LS_LANG='qpg_rps_lang', LS_THEME='qpg_rps_theme';
  const i18n={
    uk:{brand:'QuickPlay Games', title:'ROCK ¬∑ PAPER ¬∑ SCISSORS', loading:'Loading...', studioNote:'–ú—ñ–Ω—ñ–º–∞–ª—ñ–∑–º, –Ω–µ–æ–Ω, —à–≤–∏–¥–∫—ñ –º–∞—Ç—á—ñ.',
        sound:'–ó–≤—É–∫', theme:'–¢–µ–º–∞', play:'–ì—Ä–∞—Ç–∏', menuDesc:'–ö–ª–∞—Å–∏–∫–∞ –∑ —Å—É—á–∞—Å–Ω–∏–º –Ω–µ–æ–Ω-—Å—Ç–∏–ª–µ–º. –û–±–µ—Ä–∏ —Ä–µ–∂–∏–º: –ø—Ä–æ—Ç–∏ –®–Ü –∞–±–æ –æ–Ω–ª–∞–π–Ω‚Äë–∫—ñ–º–Ω–∞—Ç–∏.',
        vsAI:'–ü—Ä–æ—Ç–∏ –®–Ü', difficulty:'–°–∫–ª–∞–¥–Ω—ñ—Å—Ç—å', onlineRooms:'–û–Ω–ª–∞–π–Ω: –∫—ñ–º–Ω–∞—Ç–∏', reset:'–ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ (—Å–∫–∏–Ω—É—Ç–∏ —Ä–µ–∫–æ—Ä–¥–∏)',
        controlsHint:'–ü–ö: 1 ‚Äî ü™®, 2 ‚Äî ‚úÇÔ∏è, 3 ‚Äî üìÑ ¬∑ –ú–æ–±—ñ–ª—å–Ω—ñ: –≤–µ–ª–∏–∫—ñ –∫–Ω–æ–ø–∫–∏. –†–∞—Ö—É–Ω–æ–∫ —ñ —Å–µ—Ä—ñ—è –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è; –æ–Ω–ª–∞–π–Ω ‚Äî –ª–æ–±—ñ —Ç–∞ —Ç–∞–π–º–µ—Ä.',
        chooseMode:'–í–∏–±—ñ—Ä —Ä–µ–∂–∏–º—É', cancel:'–°–∫–∞—Å—É–≤–∞—Ç–∏', localRooms:'–õ–æ–∫–∞–ª—å–Ω—ñ –∫—ñ–º–Ω–∞—Ç–∏ (–∞–≤—Ç–æ ‚Äú–∑–∞ –∫–æ–¥–æ–º‚Äù)', p2pBeta:'P2P Beta (–±–µ–∑ —Å–µ—Ä–≤–µ—Ä–∞; –∫–æ–ø—ñ‚Äë–ø–µ–π—Å—Ç –∫–æ–¥—ñ–≤)', close:'–ó–∞–∫—Ä–∏—Ç–∏',
        localRoomTitle:'–õ–æ–∫–∞–ª—å–Ω–∞ –∫—ñ–º–Ω–∞—Ç–∞ (—Ü–µ–π –±—Ä–∞—É–∑–µ—Ä)', localCreateDesc:'–°—Ç–≤–æ—Ä–∏—Ç–∏: –Ω–∞–∑–≤–∞ + –∫–æ–¥ (5‚Äì8 —Å–∏–º–≤–æ–ª—ñ–≤) –∞–±–æ –ø–æ—Ä–æ–∂–Ω—å–æ ‚Äî –∑–≥–µ–Ω–µ—Ä—É—î–º–æ.', create:'–°—Ç–≤–æ—Ä–∏—Ç–∏',
        localJoinDesc:'–ó–Ω–∞–π—Ç–∏: –≤–≤–µ–¥—ñ—Ç—å –∫–æ–¥ –∫—ñ–º–Ω–∞—Ç–∏ ‚Äî –ø—Ä–∏—î–¥–Ω–∞—î–º–æ—Å—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ.', join:'–ü—Ä–∏—î–¥–Ω–∞—Ç–∏—Å—è', back:'–ù–∞–∑–∞–¥',
        p2pDesc:'1) –°—Ç–≤–æ—Ä–∏—Ç–∏ ‚Üí –°–∫–æ–ø—ñ—é–π ¬´Offer¬ª —ñ –ø–µ—Ä–µ–¥–∞–π —Å—É–ø–µ—Ä–Ω–∏–∫—É. 2) –í—Å—Ç–∞–≤ ¬´Answer¬ª –≤—ñ–¥ —Å—É–ø–µ—Ä–Ω–∏–∫–∞. –ê–±–æ: –ü—Ä–∏—î–¥–Ω–∞—Ç–∏—Å—è ‚Üí –í—Å—Ç–∞–≤ ¬´Offer¬ª ‚Üí –ó–≥–µ–Ω–µ—Ä—É–π ¬´Answer¬ª —ñ –ø–µ—Ä–µ–¥–∞–π —Ç–≤–æ—Ä—Ü—é.',
        yourNick:'–í–∞—à –Ω—ñ–∫', createOffer:'–°—Ç–≤–æ—Ä–∏—Ç–∏ (Offer)', joinOffer:'–ü—Ä–∏—î–¥–Ω–∞—Ç–∏—Å—è (–º–∞—é Offer)', insertAnswer:'–í—Å—Ç–∞–≤–∏—Ç–∏ –≤—ñ–¥–ø–æ–≤—ñ–¥—å',
        hintPC:'–ü–ö: 1 ¬∑ 2 ¬∑ 3 ¬∑ ESC ‚Äî –ø–∞—É–∑–∞', hintMobile:'–¢–æ—Ä–∫–Ω–∏—Å—å –∫–Ω–æ–ø–∫–∏ ¬∑ –ü–∞—É–∑–∞ ‚Äî –∫–Ω–æ–ø–∫–∞',
        mode:'–†–µ–∂–∏–º', score:'–û—á–∫–∏', streak:'–°–µ—Ä—ñ—è', best:'–†–µ–∫–æ—Ä–¥', timer:'–¢–∞–π–º–µ—Ä', pause:'–ü–∞—É–∑–∞', continue:'‚ñ∂ –ü—Ä–æ–¥–æ–≤–∂–∏—Ç–∏', restartMatch:'üîÅ –†–µ—Å—Ç–∞—Ä—Ç –º–∞—Ç—á—É', backMenu:'‚ùå –í –º–µ–Ω—é',
        matchEnded:'–ú–∞—Ç—á –∑–∞–≤–µ—Ä—à–µ–Ω–æ', playAgain:'‚ñ∂ –ó—ñ–≥—Ä–∞—Ç–∏ —â–µ', makeChoice:'–ó—Ä–æ–±–∏ –≤–∏–±—ñ—Ä', rock:'–ö–∞–º—ñ–Ω—å', scissors:'–ù–æ–∂–∏—Ü—ñ', paper:'–ü–∞–ø—ñ—Ä',
        room:'–ö—ñ–º–Ω–∞—Ç–∞', players:'–ì—Ä–∞–≤—Ü—ñ–≤', code:'–ö–æ–¥', choiceTimer:'–¢–∞–π–º–µ—Ä –≤–∏–±–æ—Ä—É (—Å–µ–∫):', maxPlayers:'–ú–∞–∫—Å. —É—á–∞—Å–Ω–∏–∫—ñ–≤ (2..5):', startRound:'‚ñ∂ –ü–æ—á–∞—Ç–∏ —Ä–∞—É–Ω–¥', leaveRoom:'–í–∏–π—Ç–∏ –∑ –∫—ñ–º–Ω–∞—Ç–∏', timerHint:'–ü—ñ–¥–∫–∞–∑–∫–∞: —è–∫—â–æ –Ω–µ –∑—Ä–æ–±–∏—Ç–∏ –≤–∏–±—ñ—Ä –¥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è —Ç–∞–π–º–µ—Ä–∞ ‚Äî –≤–∏ –≤–∏–ª—ñ—Ç–∞—î—Ç–µ –∑ —Ä–∞—É–Ω–¥—É.',
        langLabel:'–£–∫—Ä–∞—ó–Ω—Å—å–∫–∞', themeDark:'Dark', themeLight:'Light', themeNeon:'Neon',
        alertEnterCode:'–í–≤–µ–¥—ñ—Ç—å –∫–æ–¥ –∫—ñ–º–Ω–∞—Ç–∏', alertRoomFull:'–ö—ñ–º–Ω–∞—Ç–∞ –ø–æ–≤–Ω–∞', alertResetOk:'–û–∫. –†–µ–∫–æ—Ä–¥ —Å–∫–∏–Ω—É—Ç–æ.', p2pOfferInfo:'–°–∫–æ–ø—ñ—é–π Offer —ñ –ø–µ—Ä–µ–¥–∞–π —Å—É–ø–µ—Ä–Ω–∏–∫—É. –ü–æ—Ç—ñ–º –≤—Å—Ç–∞–≤ Answer.', p2pAnswerInfo:'–°–∫–æ–ø—ñ—é–π Answer —ñ –ø–µ—Ä–µ–¥–∞–π —Ç–≤–æ—Ä—Ü—é.', p2pConnected:'–ó º—î–¥–Ω–∞–Ω–æ! –ó–∞–∫—Ä–∏–π —Ü–µ –≤—ñ–∫–Ω–æ ‚Äî —ñ –≥—Ä–∞–π.',
        youDidNotPick:'–ù–µ –≤–∏–±—Ä–∞–≤ ‚Äî –≤–∏–ª—ñ—Ç', youWin:'–¢–∏ –ø–µ—Ä–µ–º—ñ–≥!', youLose:'–¢–∏ –ø—Ä–æ–≥—Ä–∞–≤', draw:'–ù—ñ—á–∏—è', top:'–¢–æ–ø',
        throwFx:'–†–µ–∂–∏–º –∫–∏–¥–∫–∞ (3‚Äë2‚Äë1)', haptics:'–í—ñ–±—Ä–∞—Ü—ñ—è'
    },
    ru:{brand:'QuickPlay Games', title:'ROCK ¬∑ PAPER ¬∑ SCISSORS', loading:'–ó–∞–≥—Ä—É–∑–∫–∞...', studioNote:'–ú–∏–Ω–∏–º–∞–ª–∏–∑–º, –Ω–µ–æ–Ω, –±—ã—Å—Ç—Ä—ã–µ –º–∞—Ç—á–∏.',
        sound:'–ó–≤—É–∫', theme:'–¢–µ–º–∞', play:'–ò–≥—Ä–∞—Ç—å', menuDesc:'–ö–ª–∞—Å—Å–∏–∫–∞ –≤ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–º –Ω–µ–æ–Ω-—Å—Ç–∏–ª–µ. –í—ã–±–µ—Ä–∏ —Ä–µ–∂–∏–º: –ø—Ä–æ—Ç–∏–≤ –ò–ò –∏–ª–∏ –æ–Ω–ª–∞–π–Ω-–∫–æ–º–Ω–∞—Ç—ã.',
        vsAI:'–ü—Ä–æ—Ç–∏–≤ –ò–ò', difficulty:'–°–ª–æ–∂–Ω–æ—Å—Ç—å', onlineRooms:'–û–Ω–ª–∞–π–Ω: –∫–æ–º–Ω–∞—Ç—ã', reset:'–ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ (—Å–±—Ä–æ—Å–∏—Ç—å —Ä–µ–∫–æ—Ä–¥)',
        controlsHint:'–ü–ö: 1 ‚Äî ü™®, 2 ‚Äî ‚úÇÔ∏è, 3 ‚Äî üìÑ ¬∑ –ú–æ–±–∏–ª—å–Ω—ã–µ: –∫—Ä—É–ø–Ω—ã–µ –∫–Ω–æ–ø–∫–∏. –†–µ–∫–æ—Ä–¥ –∏ —Å–µ—Ä–∏—è —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è; –æ–Ω–ª–∞–π–Ω ‚Äî –ª–æ–±–±–∏ –∏ —Ç–∞–π–º–µ—Ä.',
        chooseMode:'–í—ã–±–æ—Ä —Ä–µ–∂–∏–º–∞', cancel:'–û—Ç–º–µ–Ω–∞', localRooms:'–õ–æ–∫–∞–ª—å–Ω—ã–µ –∫–æ–º–Ω–∞—Ç—ã (–∞–≤—Ç–æ ‚Äú–ø–æ –∫–æ–¥—É‚Äù)', p2pBeta:'P2P Beta (–±–µ–∑ —Å–µ—Ä–≤–µ—Ä–∞; –∫–æ–ø–∏‚Äë–ø–∞—Å—Ç –∫–æ–¥–æ–≤)', close:'–ó–∞–∫—Ä—ã—Ç—å',
        localRoomTitle:'–õ–æ–∫–∞–ª—å–Ω–∞—è –∫–æ–º–Ω–∞—Ç–∞ (—ç—Ç–æ—Ç –±—Ä–∞—É–∑–µ—Ä)', localCreateDesc:'–°–æ–∑–¥–∞—Ç—å: –Ω–∞–∑–≤–∞–Ω–∏–µ + –∫–æ–¥ (5‚Äì8 —Å–∏–º–≤–æ–ª–æ–≤) –∏–ª–∏ –ø—É—Å—Ç–æ ‚Äî —Å–≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º.', create:'–°–æ–∑–¥–∞—Ç—å',
        localJoinDesc:'–ù–∞–π—Ç–∏: –≤–≤–µ–¥–∏—Ç–µ –∫–æ–¥ –∫–æ–º–Ω–∞—Ç—ã ‚Äî –ø–æ–¥–∫–ª—é—á–∏–º—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.', join:'–ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è', back:'–ù–∞–∑–∞–¥',
        p2pDesc:'1) –°–æ–∑–¥–∞—Ç—å ‚Üí –°–∫–æ–ø–∏—Ä—É–π ¬´Offer¬ª –∏ –ø–µ—Ä–µ–¥–∞–π —Å–æ–ø–µ—Ä–Ω–∏–∫—É. 2) –í—Å—Ç–∞–≤—å ¬´Answer¬ª –æ—Ç —Å–æ–ø–µ—Ä–Ω–∏–∫–∞. –ò–ª–∏: –ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è ‚Üí –í—Å—Ç–∞–≤—å ¬´Offer¬ª ‚Üí –°–≥–µ–Ω–µ—Ä–∏—Ä—É–π ¬´Answer¬ª –∏ –ø–µ—Ä–µ–¥–∞–π —Å–æ–∑–¥–∞—Ç–µ–ª—é.',
        yourNick:'–í–∞—à –Ω–∏–∫', createOffer:'–°–æ–∑–¥–∞—Ç—å (Offer)', joinOffer:'–ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è (–µ—Å—Ç—å Offer)', insertAnswer:'–í—Å—Ç–∞–≤–∏—Ç—å –æ—Ç–≤–µ—Ç',
        hintPC:'–ü–ö: 1 ¬∑ 2 ¬∑ 3 ¬∑ ESC ‚Äî –ø–∞—É–∑–∞', hintMobile:'–ö–∞—Å–∞–π—Å—è –∫–Ω–æ–ø–æ–∫ ¬∑ –ü–∞—É–∑–∞ ‚Äî –∫–Ω–æ–ø–∫–∞',
        mode:'–†–µ–∂–∏–º', score:'–û—á–∫–∏', streak:'–°–µ—Ä–∏—è', best:'–†–µ–∫–æ—Ä–¥', timer:'–¢–∞–π–º–µ—Ä', pause:'–ü–∞—É–∑–∞', continue:'‚ñ∂ –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å', restartMatch:'üîÅ –†–µ—Å—Ç–∞—Ä—Ç –º–∞—Ç—á–∞', backMenu:'‚ùå –í –º–µ–Ω—é',
        matchEnded:'–ú–∞—Ç—á –∑–∞–≤–µ—Ä—à—ë–Ω', playAgain:'‚ñ∂ –°—ã–≥—Ä–∞—Ç—å –µ—â—ë', makeChoice:'–°–¥–µ–ª–∞–π –≤—ã–±–æ—Ä', rock:'–ö–∞–º–µ–Ω—å', scissors:'–ù–æ–∂–Ω–∏—Ü—ã', paper:'–ë—É–º–∞–≥–∞',
        room:'–ö–æ–º–Ω–∞—Ç–∞', players:'–ò–≥—Ä–æ–∫–æ–≤', code:'–ö–æ–¥', choiceTimer:'–¢–∞–π–º–µ—Ä –≤—ã–±–æ—Ä–∞ (—Å–µ–∫):', maxPlayers:'–ú–∞–∫—Å. –∏–≥—Ä–æ–∫–æ–≤ (2..5):', startRound:'‚ñ∂ –ù–∞—á–∞—Ç—å —Ä–∞—É–Ω–¥', leaveRoom:'–í—ã–π—Ç–∏ –∏–∑ –∫–æ–º–Ω–∞—Ç—ã', timerHint:'–ü–æ–¥—Å–∫–∞–∑–∫–∞: –µ—Å–ª–∏ –Ω–µ —Å–¥–µ–ª–∞—Ç—å –≤—ã–±–æ—Ä –¥–æ –∫–æ–Ω—Ü–∞ —Ç–∞–π–º–µ—Ä–∞ ‚Äî –≤—ã –≤—ã–±—ã–≤–∞–µ—Ç–µ –∏–∑ —Ä–∞—É–Ω–¥–∞.',
        langLabel:'–†—É—Å—Å–∫–∏–π', themeDark:'Dark', themeLight:'Light', themeNeon:'Neon',
        alertEnterCode:'–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥ –∫–æ–º–Ω–∞—Ç—ã', alertRoomFull:'–ö–æ–º–Ω–∞—Ç–∞ –∑–∞–ø–æ–ª–Ω–µ–Ω–∞', alertResetOk:'–û–∫. –†–µ–∫–æ—Ä–¥ —Å–±—Ä–æ—à–µ–Ω.', p2pOfferInfo:'–°–∫–æ–ø–∏—Ä—É–π Offer –∏ –ø–µ—Ä–µ–¥–∞–π —Å–æ–ø–µ—Ä–Ω–∏–∫—É. –ó–∞—Ç–µ–º –≤—Å—Ç–∞–≤—å Answer.', p2pAnswerInfo:'–°–∫–æ–ø–∏—Ä—É–π Answer –∏ –ø–µ—Ä–µ–¥–∞–π —Å–æ–∑–¥–∞—Ç–µ–ª—é.', p2pConnected:'–°–æ–µ–¥–∏–Ω–µ–Ω–æ! –ó–∞–∫—Ä–æ–π –æ–∫–Ω–æ ‚Äî –∏ –∏–≥—Ä–∞–π.',
        youDidNotPick:'–ù–µ –≤—ã–±—Ä–∞–ª ‚Äî –≤—ã–ª–µ—Ç', youWin:'–¢—ã –ø–æ–±–µ–¥–∏–ª!', youLose:'–¢—ã –ø—Ä–æ–∏–≥—Ä–∞–ª', draw:'–ù–∏—á—å—è', top:'–¢–æ–ø',
        throwFx:'–†–µ–∂–∏–º –±—Ä–æ—Å–∫–∞ (3‚Äë2‚Äë1)', haptics:'–í–∏–±—Ä–∞—Ü–∏—è'
    },
    en:{brand:'QuickPlay Games', title:'ROCK ¬∑ PAPER ¬∑ SCISSORS', loading:'Loading...', studioNote:'Minimal, neon, fast rounds.',
        sound:'Sound', theme:'Theme', play:'Play', menuDesc:'Classic with modern neon style. Choose AI or Online rooms.',
        vsAI:'Play vs AI', difficulty:'Difficulty', onlineRooms:'Online Rooms', reset:'Restart (reset record)',
        controlsHint:'PC: 1 ‚Äî ü™®, 2 ‚Äî ‚úÇÔ∏è, 3 ‚Äî üìÑ ¬∑ Mobile: large buttons. Score & streak saved; online ‚Äî lobby & timer.',
        chooseMode:'Choose Mode', cancel:'Cancel', localRooms:'Local Rooms (auto ‚Äúby code‚Äù)', p2pBeta:'P2P Beta (no server; copy/paste codes)', close:'Close',
        localRoomTitle:'Local Room (this browser)', localCreateDesc:'Create: name + code (5‚Äì8 chars) or empty ‚Äî auto.', create:'Create',
        localJoinDesc:'Join: enter room code ‚Äî auto connect.', join:'Join', back:'Back',
        p2pDesc:'1) Create ‚Üí Copy ¬´Offer¬ª and send. 2) Paste ¬´Answer¬ª. Or: Join ‚Üí Paste ¬´Offer¬ª ‚Üí Generate ¬´Answer¬ª and send back.',
        yourNick:'Your nick', createOffer:'Create (Offer)', joinOffer:'Join (have Offer)', insertAnswer:'Paste Answer',
        hintPC:'PC: 1 ¬∑ 2 ¬∑ 3 ¬∑ ESC ‚Äî pause', hintMobile:'Tap buttons ¬∑ Pause button',
        mode:'Mode', score:'Score', streak:'Streak', best:'Best', timer:'Timer', pause:'Pause', continue:'‚ñ∂ Continue', restartMatch:'üîÅ Restart match', backMenu:'‚ùå Menu',
        matchEnded:'Match ended', playAgain:'‚ñ∂ Play again', makeChoice:'Make your choice', rock:'Rock', scissors:'Scissors', paper:'Paper',
        room:'Room', players:'Players', code:'Code', choiceTimer:'Choice timer (sec):', maxPlayers:'Max players (2..5):', startRound:'‚ñ∂ Start round', leaveRoom:'Leave room', timerHint:'Hint: if you don‚Äôt choose before timer ends ‚Äî you drop from the round.',
        langLabel:'English', themeDark:'Dark', themeLight:'Light', themeNeon:'Neon',
        alertEnterCode:'Enter room code', alertRoomFull:'Room is full', alertResetOk:'OK. Record reset.', p2pOfferInfo:'Copy Offer and send to opponent. Then paste Answer.', p2pAnswerInfo:'Copy Answer and send back.', p2pConnected:'Connected! Close this window and play.',
        youDidNotPick:'No choice ‚Äî dropped', youWin:'You win!', youLose:'You lose', draw:'Draw', top:'Top',
        throwFx:'Throw FX (3‚Äë2‚Äë1)', haptics:'Haptics'
    }
  };
  let LANG = localStorage.getItem(LS_LANG) || 'uk';
  let THEME = localStorage.getItem(LS_THEME) || 'dark';
  const THEMES = ['dark','light','neon'];

  function t(k){ return (i18n[LANG] && i18n[LANG][k]) || k; }
  function applyI18N(){
    document.querySelectorAll('[data-i18n]').forEach(el=>{
      const k = el.getAttribute('data-i18n'); el.textContent = t(k);
    });
    document.getElementById('langVal').textContent = t('langLabel');
    document.getElementById('themeVal').textContent = (THEME==='dark'? t('themeDark') : THEME==='light'? t('themeLight') : t('themeNeon'));
  }
  function applyTheme(){
    document.body.classList.remove('theme-light','theme-neon');
    if(THEME==='light') document.body.classList.add('theme-light');
    else if(THEME==='neon') document.body.classList.add('theme-neon');
  }

  /* ---------- Helpers ---------- */
  const $ = (sel)=>document.querySelector(sel);
  const byId = (id)=>document.getElementById(id);
  const clamp=(v,a,b)=>Math.min(Math.max(v,a),b);
  const now=()=>performance.now();
  const pick=(arr)=>arr[Math.floor(Math.random()*arr.length)];
  const isTouch = ('ontouchstart' in window) || navigator.maxTouchPoints>0;

  /* ---------- Storage ---------- */
  const K='qpg_rps_profile_v4';
  const profile={ bestAI:0, sound:true, throwFx:true, haptics:true };
  try{ const r=localStorage.getItem(K); if(r) Object.assign(profile, JSON.parse(r)); }catch(e){}
  const save=()=>{ try{ localStorage.setItem(K, JSON.stringify(profile)); }catch(e){} };

  /* ---------- Screens ---------- */
  const screens={ loading:$('#loading'), menu:$('#menu'), game:$('#game') };
  const showScreen=(id)=>{ Object.values(screens).forEach(el=>el.style.display='none'); screens[id].style.display='flex'; applyI18N(); };

  /* ---------- Loading 3s ---------- */
  (function dots(){ const el=$('#dots'); let i=0; setInterval(()=>{ i=(i+1)%4; el.textContent=t('loading').replace('...','') + '.'.repeat(i); }, 280); })();
  setTimeout(()=>{ $('#loading').classList.add('fade-out'); setTimeout(()=> showScreen('menu'), 820); }, 3000);

  /* ---------- Audio ---------- */
  const audio={
    ctx:null, enabled(){return profile.sound}, ensure(){ if(!this.ctx){ this.ctx=new (window.AudioContext||window.webkitAudioContext)(); } },
    click(){ if(!this.enabled())return; this.ensure(); const t0=this.ctx.currentTime, o=this.ctx.createOscillator(), g=this.ctx.createGain();
      o.type='square'; o.frequency.setValueAtTime(440,t0); o.frequency.exponentialRampToValueAtTime(300,t0+0.08);
      g.gain.setValueAtTime(0.0001,t0); g.gain.exponentialRampToValueAtTime(0.25,t0+0.02); g.gain.exponentialRampToValueAtTime(0.0001,t0+0.12);
      o.connect(g).connect(this.ctx.destination); o.start(t0); o.stop(t0+0.13); },
    win(){ if(!this.enabled())return; this.ensure(); const t0=this.ctx.currentTime, o=this.ctx.createOscillator(), g=this.ctx.createGain();
      o.type='sine'; o.frequency.setValueAtTime(660,t0); o.frequency.exponentialRampToValueAtTime(880,t0+0.15);
      g.gain.setValueAtTime(0.0001,t0); g.gain.exponentialRampToValueAtTime(0.35,t0+0.05); g.gain.exponentialRampToValueAtTime(0.0001,t0+0.35);
      o.connect(g).connect(this.ctx.destination); o.start(t0); o.stop(t0+0.36); },
    lose(){ if(!this.enabled())return; this.ensure(); const t0=this.ctx.currentTime, o=this.ctx.createOscillator(), g=this.ctx.createGain();
      o.type='sine'; o.frequency.setValueAtTime(300,t0); o.frequency.exponentialRampToValueAtTime(220,t0+0.2);
      g.gain.setValueAtTime(0.0001,t0); g.gain.exponentialRampToValueAtTime(0.35,t0+0.06); g.gain.exponentialRampToValueAtTime(0.0001,t0+0.36);
      o.connect(g).connect(this.ctx.destination); o.start(t0); o.stop(t0+0.38); }
  };

  /* ---------- Menu ---------- */
  applyTheme(); applyI18N();
  byId('soundState').textContent = profile.sound?'ON':'OFF';
  byId('soundLabel').textContent = profile.sound ? (LANG==='en'?'On':LANG==='ru'?'–í–∫–ª':'–£–≤—ñ–º–∫') : (LANG==='en'?'Off':LANG==='ru'?'–í—ã–∫–ª':'–í–∏–º–∫');
  byId('throwFxVal').textContent = profile.throwFx?'ON':'OFF';
  byId('hapticsVal').textContent = profile.haptics?'ON':'OFF';

  $('#btnSound').addEventListener('click',()=>{ profile.sound=!profile.sound; save();
    byId('soundState').textContent=profile.sound?'ON':'OFF';
    byId('soundLabel').textContent = profile.sound ? (LANG==='en'?'On':LANG==='ru'?'–í–∫–ª':'–£–≤—ñ–º–∫') : (LANG==='en'?'Off':LANG==='ru'?'–í—ã–∫–ª':'–í–∏–º–∫');
    audio.click();
  });

  $('#btnLang').addEventListener('click',()=>{
    LANG = (LANG==='uk'?'ru':LANG==='ru'?'en':'uk'); localStorage.setItem(LS_LANG, LANG);
    applyI18N();
  });

  $('#btnTheme').addEventListener('click',()=>{
    const i=THEMES.indexOf(THEME); THEME = THEMES[(i+1)%THEMES.length];
    localStorage.setItem(LS_THEME, THEME); applyTheme(); applyI18N();
  });

  $('#btnThrowFx').addEventListener('click',()=>{ profile.throwFx=!profile.throwFx; save(); byId('throwFxVal').textContent=profile.throwFx?'ON':'OFF'; audio.click(); });
  $('#btnHaptics').addEventListener('click',()=>{ profile.haptics=!profile.haptics; save(); byId('hapticsVal').textContent=profile.haptics?'ON':'OFF'; audio.click(); });

  const aiOrder=['Easy','Normal','Hard']; let aiIdx=1;
  const setAIDiff=()=>{ byId('aiDiff').textContent = aiOrder[aiIdx]; }; setAIDiff();
  $('#btnAI').addEventListener('click',()=>{ aiIdx=(aiIdx+1)%aiOrder.length; setAIDiff(); audio.click(); });

  const modeOverlay=$('#modeOverlay'); const onlineOverlay=$('#onlineOverlay');
  $('#btnPlay').addEventListener('click',()=>{ modeOverlay.style.display='flex'; audio.click(); });
  $('#mAI').addEventListener('click',()=>{ modeOverlay.style.display='none'; startMatchAI(); });
  $('#mOnline').addEventListener('click',()=>{ modeOverlay.style.display='none'; onlineOverlay.style.display='flex'; });
  $('#mCancel').addEventListener('click',()=>{ modeOverlay.style.display='none'; });

  $('#btnOnline').addEventListener('click',()=>{ onlineOverlay.style.display='flex'; audio.click(); });
  $('#oClose').addEventListener('click',()=>{ onlineOverlay.style.display='none'; });

  $('#btnReset').addEventListener('click',()=>{
    if(confirm(t('reset'))){ profile.bestAI=0; save(); alert(t('alertResetOk')); }
  });

  /* ---------- Match: AI ---------- */
  let match=null, hotKeysOn=false;
  const R= { ROCK:'rock', SCISSORS:'scissors', PAPER:'paper' };
  const beats = { rock:'scissors', scissors:'paper', paper:'rock' };

  function startMatchAI(){
    showScreen('game'); audio.click();
    byId('modeLabel').textContent = `${t('vsAI')} (${aiOrder[aiIdx]})`;
    byId('best').textContent = profile.bestAI;
    byId('timerWrap').style.display = 'none';
    byId('hint').textContent = isTouch ? t('hintMobile') : t('hintPC');
    match = { score:0, streak:0, best: profile.bestAI, lastPlayer:null, waitForPick:true };
    updateHUD(); setCenter(t('makeChoice'),'ü™® / ‚úÇÔ∏è / üìÑ');
    enableHotkeys(true); bindButtonsAI();
  }
  function updateHUD(){
    byId('score').textContent = match.score;
    byId('streak').textContent= match.streak;
    byId('best').textContent  = profile.bestAI;
  }
  function setCenter(main, sub){
    const c=byId('centerBox'); byId('resultText').textContent=main; byId('roundInfo').textContent=sub||''; c.classList.remove('glow-win','glow-lose');
  }
  function bindButtonsAI(){
    const playPick = (val)=>{ if(!match || !match.waitForPick) return; resolveRoundAI(val); };
    $('#btnRock').onclick=()=>playPick(R.ROCK);
    $('#btnScissors').onclick=()=>playPick(R.SCISSORS);
    $('#btnPaper').onclick=()=>playPick(R.PAPER);
  }
  function enableHotkeys(on){
    const hk=(e)=>{
      if(['Digit1','Digit2','Digit3','Escape'].includes(e.code)){ e.preventDefault(); e.stopPropagation(); }
      if(e.code==='Digit1') $('#btnRock').click();
      if(e.code==='Digit2') $('#btnScissors').click();
      if(e.code==='Digit3') $('#btnPaper').click();
      if(e.code==='Escape') $('#btnPause').click();
    };
    if(on && !hotKeysOn){ hotKeysOn=true; window.addEventListener('keydown',hk,true); }
    else if(!on && hotKeysOn){ hotKeysOn=false; window.removeEventListener('keydown',hk,true); }
  }
  function aiPick(playerPrev){
    const d=aiOrder[aiIdx];
    if(d==='Easy') return pick([R.ROCK,R.SCISSORS,R.PAPER]);
    if(d==='Normal'){
      const base=[R.ROCK,R.SCISSORS,R.PAPER];
      if(playerPrev){ const counter=counterOf(playerPrev); base.push(counter,counter); }
      return pick(base);
    }
    const base=[R.ROCK,R.SCISSORS,R.PAPER];
    if(playerPrev){ const counter=counterOf(playerPrev); base.push(counter,counter,counter); }
    return pick(base);
  }
  function counterOf(v){
    if(v===R.ROCK) return R.PAPER;
    if(v===R.SCISSORS) return R.ROCK;
    return R.SCISSORS;
  }

  // –ê–Ω—ñ–º–∞—Ü—ñ—è ¬´–∫–∏–¥–∞–Ω–Ω—è¬ª 3‚Äë2‚Äë1 (–∫–æ—Ä–æ—Ç–∫–∞, –±–µ–∑ –ª–∞–≥—ñ–≤)
  function throwFX(next){
    if(!profile.throwFx){ next(); return; }
    const seq=['3','2','1','üî•'];
    let i=0;
    const step=()=>{
      setCenter(seq[i], '‚úä ‚úä ‚úä');
      if(profile.haptics && navigator.vibrate) try{ navigator.vibrate(20); }catch(e){}
      i++;
      if(i<seq.length) setTimeout(step, 220);
      else setTimeout(next, 80);
    };
    step();
  }

  function resolveRoundAI(playerChoice){
    audio.click();
    match.waitForPick=false;
    throwFX(()=>{
      const ai = aiPick(match.lastPlayer);
      match.lastPlayer = playerChoice;
      const res = outcome(playerChoice, ai);
      if(res>0){ match.score+=1; match.streak+=1; showResult(t('youWin'), `You: ${icon(playerChoice)} ¬∑ AI: ${icon(ai)}`, true); audio.win(); }
      else if(res<0){ match.streak=0; showResult(t('youLose'), `You: ${icon(playerChoice)} ¬∑ AI: ${icon(ai)}`, false); audio.lose(); }
      else { showResult(t('draw'), `You: ${icon(playerChoice)} ¬∑ AI: ${icon(ai)}`); }
      updateHUD();
      profile.bestAI=Math.max(profile.bestAI, match.score); save(); byId('best').textContent=profile.bestAI;
      setTimeout(()=>{ match.waitForPick=true; setCenter(t('makeChoice'),'ü™® / ‚úÇÔ∏è / üìÑ'); }, 700);
    });
  }
  function outcome(a,b){ if(a===b) return 0; return (beats[a]===b)? +1 : -1; }
  function icon(v){ return v===R.ROCK?'ü™®': (v===R.SCISSORS?'‚úÇÔ∏è':'üìÑ'); }
  function showResult(main, sub, win=null){
    setCenter(main,sub);
    const c=byId('centerBox');
    if(win===true){ c.classList.add('glow-win'); c.classList.remove('glow-lose'); }
    else if(win===false){ c.classList.add('glow-lose'); c.classList.remove('glow-win'); }
  }

  // Pause/Result
  const pauseO=$('#pauseOverlay'), resultO=$('#resultOverlay');
  $('#btnPause').addEventListener('click',togglePause);
  $('#btnContinue').addEventListener('click',togglePause);
  $('#btnRestartRun').addEventListener('click',()=>{ resultO.style.display='none'; pauseO.style.display='none'; startMatchAI(); });
  $('#btnBackMenu').addEventListener('click',()=>{ resultO.style.display='none'; pauseO.style.display='none'; showScreen('menu'); match=null; });
  $('#btnAgain').addEventListener('click',()=>{ resultO.style.display='none'; startMatchAI(); });
  $('#btnToMenu').addEventListener('click',()=>{ resultO.style.display='none'; showScreen('menu'); match=null; });
  function togglePause(){
    if(!match) return;
    if(resultO.style.display==='flex') return;
    pauseO.style.display = (pauseO.style.display==='flex') ? 'none' : 'flex';
  }

  /* ---------- –û–Ω–ª–∞–π–Ω: –õ–æ–∫–∞–ª—å–Ω—ñ –∫—ñ–º–Ω–∞—Ç–∏ ---------- */
  const localUI={
    overlay: $('#localRoomOverlay'),
    name: byId('localName'), roomName: byId('localRoomName'), roomCode: byId('localRoomCode'),
    joinCode: byId('localJoinCode'),
    createBtn: byId('localCreate'), joinBtn: byId('localJoin'), closeBtn: byId('localClose')
  };
  const lobbyUI={
    overlay: $('#lobbyOverlay'), title: byId('lobbyTitle'), info: byId('lobbyInfo'),
    count: byId('lobbyCount'), code: byId('lobbyCode'),
    timer: byId('lobbyTimer'), max: byId('lobbyMax'),
    start: byId('lobbyStart'), leave: byId('lobbyLeave')
  };
  let localRoom=null;

  $('#oLocal').addEventListener('click',()=>{ $('#onlineOverlay').style.display='none'; localUI.overlay.style.display='flex'; audio.click(); });
  localUI.createBtn.addEventListener('click',()=>{
    const nick = localUI.name.value.trim() || `Player${Math.floor(Math.random()*1000)}`;
    const code = (localUI.roomCode.value.trim() || genCode()).toUpperCase();
    const name = localUI.roomName.value.trim() || `Room ${code}`;
    startLocalRoom('host', nick, name, code);
  });
  localUI.joinBtn.addEventListener('click',()=>{
    const nick = localUI.name.value.trim() || `Player${Math.floor(Math.random()*1000)}`;
    const code = (localUI.joinCode.value.trim()).toUpperCase();
    if(!code){ alert(t('alertEnterCode')); return; }
    startLocalRoom('guest', nick, null, code);
  });
  localUI.closeBtn.addEventListener('click',()=>{ localUI.overlay.style.display='none'; });

  function genCode(){ const s='ABCDEFGHJKLMNPQRSTUVWXYZ0123456789'; let r='QP'; for(let i=0;i<3;i++) r+=s[Math.floor(Math.random()*s.length)]; return r; }

  function startLocalRoom(role, nick, name, code){
    audio.click();
    localUI.overlay.style.display='none';
    const ch = new BroadcastChannel(`RPS_LOCAL_${code}`);
    showScreen('game'); byId('modeLabel').textContent='Online (Local)'; byId('hint').textContent=isTouch?t('hintMobile'):t('hintPC');
    const me = { id:`u${Math.random().toString(36).slice(2,8)}`, nick, score:0, choice:null };
    const state = {
      role, code, name: name||'', me, max:5, timerSec:10,
      players: {}, hostId: null, roundEnds:0, inRound:false
    };
    state.players[me.id]=me; if(role==='host'){ state.hostId = me.id; state.name = name; }
    setupLobbyUI(state);

    ch.onmessage = (ev)=> handleLocalMsg(ev.data);
    ch.postMessage({t:'hello', from:me.id, nick:me.nick});
    if(role==='host'){ setTimeout(()=>broadcastState(), 50); }

    lobbyUI.start.onclick=()=>{ if(isHost()) startLocalRound(); };
    lobbyUI.leave.onclick=()=>{ ch.postMessage({t:'leave', id:me.id}); ch.close(); localRoom=null; showScreen('menu'); };
    lobbyUI.timer.onchange=()=>{ if(isHost()){ state.timerSec= clamp(parseInt(lobbyUI.timer.value||'10'),1,30); broadcastState(); } };
    lobbyUI.max.onchange=()=>{ if(isHost()){ state.max= clamp(parseInt(lobbyUI.max.value||'5'),2,5); broadcastState(); } };

    const sendPick=(choice)=>{ audio.click(); ch.postMessage({t:'pick', id:me.id, choice}); const meP=state.players[me.id]; if(meP) meP.choice = choice;
      if(profile.throwFx){ // –ª–æ–∫–∞–ª—å–Ω–æ ‚Äî –∫–æ—Ä–æ—Ç–∫–∏–π FX –ø–µ—Ä–µ–¥ –ø–æ–∫–∞–∑–æ–º ¬´–≤–∏–±—ñ—Ä –∑–±–µ—Ä–µ–∂–µ–Ω–æ¬ª
        setCenter('3','‚úä ‚úä ‚úä'); setTimeout(()=>setCenter('2','‚úä ‚úä ‚úä'),220); setTimeout(()=>setCenter('1','‚úä ‚úä ‚úä'),440); setTimeout(()=>setCenter(t('makeChoice'), icon(choice)),660);
      } else setCenter(t('makeChoice'), icon(choice));
      if(profile.haptics && navigator.vibrate) try{ navigator.vibrate(15); }catch(e){} };
    $('#btnRock').onclick=()=>sendPick('rock');
    $('#btnScissors').onclick=()=>sendPick('scissors');
    $('#btnPaper').onclick=()=>sendPick('paper');

    function handleLocalMsg(m){
      if(!m||!m.t) return;
      if(m.t==='hello'){
        if(Object.keys(state.players).length>=state.max){ ch.postMessage({t:'full'}); return; }
        if(isHost()){
          const p={ id:m.from, nick:m.nick||('Player'+m.from.slice(-3)), score:0, choice:null };
          state.players[p.id]=p; broadcastState();
        }else{
          ch.postMessage({t:'reqState'});
        }
      }else if(m.t==='full'){
        alert(t('alertRoomFull')); showScreen('menu');
      }else if(m.t==='state'){
        Object.assign(state, m.state); setupLobbyUI(state);
      }else if(m.t==='reqState' && isHost()){
        broadcastState();
      }else if(m.t==='leave'){
        delete state.players[m.id]; if(isHost()) broadcastState();
      }else if(m.t==='startRound'){
        state.inRound=true; state.roundEnds = m.ends;
        Object.values(state.players).forEach(p=>{ p.choice=null; });
        setupLobbyUI(state); runRoundTimer();
        setCenter(t('makeChoice'), `üïí ${state.timerSec}s`);
      }else if(m.t==='pick'){
        const p=state.players[m.id]; if(p) p.choice = m.choice;
      }else if(m.t==='results'){
        applyResults(m.results);
      }
    }
    function isHost(){ return state.hostId===me.id; }
    function broadcastState(){
      ch.postMessage({t:'state', state:{
        role:state.role, code:state.code, name:state.name, max:state.max, timerSec:state.timerSec,
        players:state.players, hostId:state.hostId, inRound:state.inRound, roundEnds:state.roundEnds
      }});
      setupLobbyUI(state);
    }
    function setupLobbyUI(s){
      $('#lobbyOverlay').style.display='flex';
      lobbyUI.title.textContent = s.name ? `${t('room')}: ${s.name}` : t('room');
      lobbyUI.count.textContent = Object.keys(s.players).length;
      lobbyUI.code.textContent = s.code;
      lobbyUI.timer.value = s.timerSec;
      lobbyUI.max.value   = s.max;
    }
    function startLocalRound(){
      state.inRound=true; state.roundEnds = now() + state.timerSec*1000;
      Object.values(state.players).forEach(p=>{ p.choice=null; });
      ch.postMessage({t:'startRound', ends: state.roundEnds}); runRoundTimer();
      setCenter(t('makeChoice'), `üïí ${state.timerSec}s`);
    }
    function runRoundTimer(){
      if(!state.inRound) return;
      const left = Math.max(0, (state.roundEnds - now())/1000);
      byId('timerWrap').style.display=''; byId('timerVal').textContent = left.toFixed(1);
      if(left>0){ requestAnimationFrame(runRoundTimer); }
      else{ byId('timerWrap').style.display='none'; if(isHost()) computeResults(); }
    }
    function computeResults(){
      const alive = Object.values(state.players).filter(p=>p.choice!=null);
      const results = { winners:[], losers:[], ties:[], none:[] };
      const choices = new Set(alive.map(p=>p.choice));
      if(choices.size===0){ results.ties = Object.values(state.players).map(p=>p.id); }
      else if(choices.size===1 || choices.size===3){ results.ties = alive.map(p=>p.id); }
      else{
        const arr=[...choices]; const wins = resolveMulti(arr[0], arr[1]);
        results.winners = alive.filter(p=>p.choice===wins).map(p=>p.id);
        results.losers  = alive.filter(p=>p.choice!==wins).map(p=>p.id);
      }
      const none = Object.values(state.players).filter(p=>p.choice==null).map(p=>p.id);
      results.none = none;
      for(const id of results.winners){ if(state.players[id]) state.players[id].score=(state.players[id].score||0)+1; }
      ch.postMessage({t:'results', results}); applyResults(results); state.inRound=false; broadcastState();
    }
    function resolveMulti(a,b){
      if(a===b) return a;
      if(a==='rock'&&b==='scissors') return 'rock';
      if(a==='scissors'&&b==='paper') return 'scissors';
      if(a==='paper'&&b==='rock') return 'paper';
      return resolveMulti(b,a);
    }
    function applyResults(res){
      const my = state.players[me.id];
      let text='';
      if(res.none.includes(me.id)){ text=t('youDidNotPick'); audio.lose(); }
      else if(res.winners.includes(me.id)){ text=t('youWin'); audio.win(); }
      else if(res.losers.includes(me.id)){ text=t('youLose'); audio.lose(); }
      else { text=t('draw'); }
      const top = Object.values(state.players).sort((a,b)=>(b.score||0)-(a.score||0)).map(p=>`${p.nick}:${p.score||0}`).slice(0,5).join(' ¬∑ ');
      setCenter(text, `${t('top')}: ${top}`);
    }

    localRoom={ ch, state, me };
  }

  /* ---------- P2P Beta (WebRTC copy/paste) ---------- */
  const rtc={ pc:null, dc:null, name:'',
    async createOffer(){ this.pc=new RTCPeerConnection({iceServers:[{urls:'stun:stun.l.google.com:19302'}]}); this.dc=this.pc.createDataChannel('rps'); wireDC(this.dc);
      const offer=await this.pc.createOffer(); await this.pc.setLocalDescription(offer); return btoa(JSON.stringify(offer)); },
    async acceptAnswer(b64){ const ans=JSON.parse(atob(b64)); await this.pc.setRemoteDescription(new RTCSessionDescription(ans)); },
    async acceptOffer(b64){ this.pc=new RTCPeerConnection({iceServers:[{urls:'stun:stun.l.google.com:19302'}]}); this.pc.ondatachannel=(e)=>{ this.dc=e.channel; wireDC(this.dc); };
      const off=JSON.parse(atob(b64)); await this.pc.setRemoteDescription(new RTCSessionDescription(off)); const ans=await this.pc.createAnswer(); await this.pc.setLocalDescription(ans); return btoa(JSON.stringify(ans)); }
  };
  function wireDC(dc){ dc.onopen=()=>{ dc.send(JSON.stringify({t:'hello', name:rtc.name})); };
    dc.onmessage=(e)=>{ const m=JSON.parse(e.data); if(m.t==='rps'){ p2pApply(m); } };
  }
  function p2pSend(m){ if(rtc.dc && rtc.dc.readyState==='open') rtc.dc.send(JSON.stringify(m)); }

  const p2pUI={ overlay:$('#p2pOverlay'), name:byId('p2pName'), box:byId('p2pBox'),
    create:byId('p2pCreate'), join:byId('p2pJoin'), accept:byId('p2pAccept'), close:byId('p2pClose') };
  p2pUI.create.onclick=async()=>{ rtc.name=p2pUI.name.value.trim()||`Player${Math.floor(Math.random()*999)}`; const code=await rtc.createOffer(); p2pUI.box.value=code; alert(t('p2pOfferInfo')); };
  p2pUI.join.onclick=async()=>{ rtc.name=p2pUI.name.value.trim()||`Player${Math.floor(Math.random()*999)}`; const offer=prompt('Offer:'); if(!offer) return; const answer=await rtc.acceptOffer(offer); p2pUI.box.value=answer; alert(t('p2pAnswerInfo')); };
  p2pUI.accept.onclick=async()=>{ const ans=p2pUI.box.value.trim(); if(!ans){ alert(t('insertAnswer')); return; } await rtc.acceptAnswer(ans); alert(t('p2pConnected')); };
  p2pUI.close.onclick=()=>{ p2pUI.overlay.style.display='none'; };

  function p2pApply(m){ if(m.act==='result'){ setCenter(m.text, m.sub); if(profile.haptics && navigator.vibrate) try{ navigator.vibrate(20);}catch(e){}; } }

  /* ---------- Init ---------- */
  applyTheme(); applyI18N();

})();
</script>
</body>
</html>
